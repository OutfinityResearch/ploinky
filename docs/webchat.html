<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebChat - Ploinky</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <a href="index.html" class="logo">
                    <div class="logo-icon">üöÄ</div>
                    <span>Ploinky</span>
                </a>
                <nav>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="cli-reference.html">CLI Reference</a></li>
                        <li><a href="architecture.html">Architecture</a></li>
                        <li><a href="spec-agent.html">Agent Spec</a></li>
                        <li><a href="webchat.html" class="active">WebChat</a></li>
                        <li><a href="spec-webmeet.html">WebMeet</a></li>
                        <li><button class="theme-toggle" id="themeToggle">üåô</button></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <main>
        <div class="container">
            <div class="content-wrapper">
                <div class="doc-section">
                    <h1>WebChat - Transform CLI into a Conversation</h1>
                    <p class="subtitle">WebChat makes any agent CLI available through a chat-style interface that users can reach from their browser.</p>
                </div>

                <div class="doc-section">
                    <h2>What WebChat Delivers</h2>
                    <div class="features" style="margin-top: 2rem;">
                        <div class="feature-card">
                            <div class="feature-icon">üí¨</div>
                            <h3>Conversational UI</h3>
                            <p>Stream CLI input/output through a WhatsApp-inspired interface with bubbles, timestamps, and typing indicators.</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">üîê</div>
                            <h3>Token Security</h3>
                            <p>Each session is gated by an access token that lives in <code>.ploinky/.secrets</code>. Share the URL to grant access.</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">üõ†Ô∏è</div>
                            <h3>Agent Ready</h3>
                            <p>When a static workspace agent is configured, WebChat automatically connects to that agent‚Äôs manifest <code>cli</code> command.</p>
                        </div>
                    </div>
                </div>

                <div class="doc-section">
                    <h2>Access & Tokens</h2>
                    <p>Use <code>ploinky webchat</code> to print the current access URL or pass <code>--rotate</code> to mint a fresh token when needed.</p>
                    <pre><code>ploinky webchat          # ensure token and show access URL
ploinky webchat --rotate # regenerate the token</code></pre>
                    <div class="alert alert-info">
                        Access URL format: <code>http://127.0.0.1:8080/webchat?token=&lt;WEBCHAT_TOKEN&gt;</code>
                    </div>
                    <p>The token is stored as <code>WEBCHAT_TOKEN</code> in <code>.ploinky/.secrets</code>. Removing the entry or using <code>--rotate</code> forces a regeneration.</p>
                </div>

                <div class="doc-section">
                    <h2>How Commands Are Chosen</h2>
                    <p>WebChat derives its runtime command from the static workspace agent:</p>
                    <ol>
                        <li><strong>Static agent</strong> ‚Äì Configure one with <code>ploinky start &lt;agent&gt; &lt;port&gt;</code>. The router records the agent‚Äôs manifest path.</li>
                        <li><strong>Manifest CLI</strong> ‚Äì When the agent‚Äôs <code>manifest.json</code> defines a <code>cli</code> command, WebChat runs it inside the agent container.</li>
                        <li><strong>No CLI?</strong> ‚Äì Sessions still open, but the chat will display a notice that no command is bound.</li>
                    </ol>
                    <p>This flow depends entirely on the static workspace agent: keep its manifest updated to control which CLI the chat session runs.</p>
                </div>

                <div class="doc-section">
                    <h2>Session Experience</h2>
                    <h3>Message Rendering</h3>
                    <ul style="margin-left: 2rem;">
                        <li>‚úÖ Automatic timestamps for each exchange</li>
                        <li>‚úÖ Rich markdown rendering (tables, code blocks, lists)</li>
                        <li>‚úÖ Long output folding with ‚ÄúShow more‚Äù expansion</li>
                        <li>‚úÖ Side panel to inspect full message history</li>
                    </ul>

                    <h3>Input Controls</h3>
                    <ul style="margin-left: 2rem;">
                        <li>‚úÖ Auto-resizing composer with keyboard shortcuts (Enter to send, Shift+Enter for new line)</li>
                        <li>‚úÖ Light/Dark/Explorer theme selector with persistent preference (Settings ‚Üí Appearance)</li>
                        <li>‚úÖ Optional speech-to-text and text-to-speech integrations (see <code>cli/server/webchat/strategies</code>)</li>
                    </ul>
                </div>

                <div class="doc-section">
                    <h2>Security Practices</h2>
                    <ul style="margin-left: 2rem;">
                        <li>Rotate tokens regularly with <code>ploinky webchat --rotate</code>.</li>
                        <li>Prefer sharing short-lived tokens and revoke access by rotating after a session concludes.</li>
                        <li>Remember that tokens live in <code>.ploinky/.secrets</code>; secure that directory if you back it up or sync it.</li>
                    </ul>
                </div>

                <div class="doc-section">
                    <h2>Troubleshooting</h2>
                    <ul style="margin-left: 2rem;">
                        <li><strong>Blank session?</strong> Verify the static agent has a <code>cli</code> command in its manifest.</li>
                        <li><strong>401 errors?</strong> Run <code>ploinky webchat</code> again to confirm the token and URL.</li>
                        <li><strong>Need a different command?</strong> Update the agent manifest and restart the workspace so WebChat picks up the change.</li>
                    </ul>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2024 Ploinky Project. Built with security and simplicity in mind.</p>
            <p>
                <a href="https://github.com/ploinky/ploinky">GitHub</a> ‚Ä¢ 
                <a href="index.html">Home</a> ‚Ä¢ 
                <a href="cli-reference.html">CLI Reference</a>
            </p>
        </div>
    </footer>

    <script>
        // Theme toggle
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;
        
        const savedTheme = localStorage.getItem('theme') || 'light';
        body.setAttribute('data-theme', savedTheme);
        themeToggle.textContent = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        
        themeToggle.addEventListener('click', () => {
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            body.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            themeToggle.textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        });
    </script>
</body>
</html>
