
===== PREPARE STAGE =====
[PASS] Temporary workspace directory exists
[PASS] Repository directory created
[PASS] Agent manifest present
[PASS] Agent entry registered
[PASS] Repository enabled flag recorded
[PASS] Isolated agent workspace created

===== START STAGE =====
[PASS] Service container is running
[PASS] Router port 35613 listening
[PASS] Agent host port 29064 listening
[PASS] Agent port 29064 bound to localhost
[PASS] Router status endpoint responds
[PASS] Agent health endpoint reports ok
[PASS] Container exposes AGENT_NAME
[PASS] Container exposes FAST_TEST_MARKER
[PASS] Agent log file created
[PASS] Persisted data file created

===== Health Probes Agent =====
[PASS] Health probes agent container is running

===== Alias-enabled Agent through manifest =====
[PASS] Global alias agent uses workspace root

===== Watchdog restart services =====
[PASS] Watchdog restarts router and agent container

===== Ploinky only var test =====
[PASS] Host-only env var not visible inside container

===== Router var change =====
[PASS] Router reflects updated testVar without restart

===== Workspace status command =====
[PASS] Status reports SSO disabled
[PASS] Status reports router listening
[PASS] Status lists repos section
[PASS] Status lists demo repo
[PASS] Status lists testRepo repo
[PASS] Status lists active containers for demo
[PASS] Status lists active containers for testAgent

===== Demo agent dependency tests =====
[PASS] Simulator container is running
[PASS] Moderator container is running
[PASS] Moderator server responds to GET
[PASS] Verify repo 'webmeet' is cloned
[PASS] Verify repo 'vibe1' is cloned

===== Check preinstall runs =====
[PASS] Explorer preinstall command executed

===== MCP tests =====
[PASS] Status check: client status simulator
[PASS] Tool check: client list tools
[PASS] Tool run check: client tool run_simulation -iterations 10

===== RoutingServer aggregation test =====
[PASS] Aggregation check: router server mcp aggregation

===== CLI Variable Commands =====
[PASS] var sets test_var
[PASS] vars lists test_var
[PASS] echo returns test_var
[PASS] expose applies to test_var
[PASS] Agent sees exposed test_var via shell

===== WebChat Command =====
[PASS] webchat --rotate regenerates token

===== WebChat SSO Parameters =====
[PASS] WebChat CLI session logs guest SSO args

===== Router Static Assets =====
[PASS] Router serves configured static asset

===== Manifest Environment =====
[PASS] Variable MY_TEST_VAR from manifest is present after start

===== Install Command Verification =====
[PASS] Install command creates marker file (verified via shell)

===== Postinstall Verification =====
[PASS] Postinstall command creates marker file

===== Agent Blob Upload and Download =====
[PASS] Router upload stores blob in agent workspace
[PASS] Router download returns uploaded blob

===== Demo Agent Filesystem =====
[PASS] Demo agent directories exist and are read-only

===== Global Agent Verification =====
[PASS] Global agent working directory is the test root
[PASS] Manifest dependency global agent uses workspace root

===== Devel Agent Verification =====
[PASS] Devel agent cwd is the repo source and has RW permissions
[PASS] Manifest dependency devel agent uses repo root

===== WebTTY Command =====
[PASS] webtty command records mock shell configuration

===== Disable Repo Command =====
[PASS] disable repo removes demo entry

===== Logs Commands =====
[PASS] logs tail router streams entries
[PASS] logs last prints five lines

===== LLM CLI Suggestions =====
[FAIL] Invalid CLI input yields LLM suggestion and system command output
        Error: LLM suggestion output is empty.
/home/mircea/Desktop/ploinky/tests/test-functions/llm_cli_suggestions.sh: line 32: printf: --: invalid option
printf: usage: printf [-v var] format [arguments]
Asking the LLM for guidance...
LLM call failed: API key invalid.
Run `help` to see all available Ploinky commands and their usage.
[FAIL] testsAfterStart.sh reported 1 failure(s).

===== STOP STAGE =====
[PASS] Container exists after stop
[PASS] Container is no longer running
[PASS] Router port 35613 closed
[PASS] Agent port 29064 closed
[PASS] Manual persistence marker retained
[PASS] Agent data file retained
[PASS] Router log records shutdown

===== START AGAIN STAGE =====

===== Devel Alias Agent Verification =====
[PASS] Alias devel agent uses repo workspace

===== Health Probes Failure Verification =====
[PASS] Health probes retry and fail as expected
[PASS] Health probe scripts restored to success

===== Tests after start =====
[PASS] Service container is running
[PASS] Router port 35613 listening
[PASS] Agent host port 29064 listening
[PASS] Agent port 29064 bound to localhost
[PASS] Router status endpoint responds
[PASS] Agent health endpoint reports ok
[PASS] Container exposes AGENT_NAME
[PASS] Container exposes FAST_TEST_MARKER
[PASS] Agent log file created
[PASS] Persisted data file created

===== Health Probes Agent =====
[PASS] Health probes agent container is running

===== Alias-enabled Agent through manifest =====
[PASS] Global alias agent uses workspace root

===== Watchdog restart services =====
[PASS] Watchdog restarts router and agent container

===== Ploinky only var test =====
[PASS] Host-only env var not visible inside container

===== Router var change =====
[PASS] Router reflects updated testVar without restart

===== Workspace status command =====
[PASS] Status reports SSO disabled
[PASS] Status reports router listening
[PASS] Status lists repos section
[PASS] Status lists demo repo
[PASS] Status lists testRepo repo
[PASS] Status lists active containers for demo
[PASS] Status lists active containers for testAgent

===== Demo agent dependency tests =====
[PASS] Simulator container is running
[PASS] Moderator container is running
[PASS] Moderator server responds to GET
[PASS] Verify repo 'webmeet' is cloned
[PASS] Verify repo 'vibe1' is cloned

===== Check preinstall runs =====
[PASS] Explorer preinstall command executed

===== MCP tests =====
[PASS] Status check: client status simulator
[PASS] Tool check: client list tools
[PASS] Tool run check: client tool run_simulation -iterations 10

===== RoutingServer aggregation test =====
[PASS] Aggregation check: router server mcp aggregation

===== CLI Variable Commands =====
[PASS] var sets test_var
[PASS] vars lists test_var
[PASS] echo returns test_var
[PASS] expose applies to test_var
[PASS] Agent sees exposed test_var via shell

===== WebChat Command =====
[PASS] webchat --rotate regenerates token

===== WebChat SSO Parameters =====
[PASS] WebChat CLI session logs guest SSO args

===== Router Static Assets =====
[PASS] Router serves configured static asset

===== Manifest Environment =====
[PASS] Variable MY_TEST_VAR from manifest is present after start

===== Install Command Verification =====
[PASS] Install command creates marker file (verified via shell)

===== Postinstall Verification =====
[PASS] Postinstall command creates marker file

===== Agent Blob Upload and Download =====
[PASS] Router upload stores blob in agent workspace
[PASS] Router download returns uploaded blob

===== Demo Agent Filesystem =====
[PASS] Demo agent directories exist and are read-only

===== Global Agent Verification =====
[PASS] Global agent working directory is the test root
[PASS] Manifest dependency global agent uses workspace root

===== Devel Agent Verification =====
[PASS] Devel agent cwd is the repo source and has RW permissions
[PASS] Manifest dependency devel agent uses repo root

===== WebTTY Command =====
[PASS] webtty command records mock shell configuration

===== Disable Repo Command =====
[PASS] disable repo removes demo entry

===== Logs Commands =====
[PASS] logs tail router streams entries
[PASS] logs last prints five lines

===== LLM CLI Suggestions =====
[FAIL] Invalid CLI input yields LLM suggestion and system command output
        Error: LLM suggestion output is empty.
/home/mircea/Desktop/ploinky/tests/test-functions/llm_cli_suggestions.sh: line 32: printf: --: invalid option
printf: usage: printf [-v var] format [arguments]
Asking the LLM for guidance...
LLM call failed: API key invalid.
Run `help` to see all available Ploinky commands and their usage.
[FAIL] testsAfterStartAgain.sh reported 1 failure(s).

===== RESTART STAGE =====
[PASS] Service container is running
[PASS] Router port 35613 listening
[PASS] Agent host port 29064 listening
[PASS] Router status endpoint responds
[PASS] Agent health endpoint reports ok
[PASS] Container exposes AGENT_NAME
[PASS] Container exposes FAST_TEST_MARKER
[PASS] Agent log file created
[PASS] Persisted data file created
[PASS] Container PID changed after restart
[PASS] Persistence marker retained after restart

===== Manifest Environment =====
[PASS] Variable MY_TEST_VAR from manifest is present after restart

===== DESTROY STAGE =====
[PASS] agentToBeDisabled no longer in agents registry
[PASS] Router log snapshot records shutdown
[PASS] RoutingServer process stopped
[PASS] Test agent container removed
[PASS] Temporary workspace directory deleted
[PASS] Agent log removed with workspace
[PASS] Persistence marker removed with workspace

===== NODE UNIT STAGE =====
[PASS] Node unit tests

===== TEST SUMMARY =====
[FAIL] Suite finished with 2 failure(s).
